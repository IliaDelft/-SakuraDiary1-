<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ü—É–±–ª–∏—á–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Äî Sakura</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ffeef6">
  <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="apple-touch-icon" href="favicon.svg">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap&subset=cyrillic-ext" rel="stylesheet">
  <style>
    :root{--bg:#fff8fb;--panel:#ffeef6;--ink:#2b2b2b;--muted:#6c6c6c;--line:#f5cfe0}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.6 'Manrope',ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
    .wrap{max-width:960px;margin:20px auto;padding:0 14px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px}
    .grid{display:grid;gap:12px}
    pre{background:#fff;border:1px dashed var(--line);border-radius:12px;padding:12px;overflow:auto}
    .muted{color:var(--muted)}
    .sakura-lite{position:fixed;inset:0;pointer-events:none;z-index:-1}
    .lite{position:absolute;opacity:.35;font-size:18px;animation:fall linear infinite}
    @keyframes fall{0%{transform:translateY(-10vh) rotate(0)}100%{transform:translateY(110vh) rotate(360deg);opacity:0}}
    @media(print){.sakura-lite{display:none}}
  </style>
</head>
<body>
  <div class="sakura-lite" id="sak"></div>
  <div class="wrap">
    <div class="card grid">
      <h1 style="margin:0">üå∏ –ü—É–±–ª–∏—á–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Äî Sakura</h1>
      <div id="status" class="muted">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      <div id="main" style="display:none">
        <div class="grid" style="grid-template-columns:1fr 1fr 1fr">
          <div><b>–ò–º—è</b><div id="v_name" class="muted">‚Äî</div></div>
          <div><b>–î–∞—Ç–∞</b><div id="v_date" class="muted">‚Äî</div></div>
          <div><b>–ù–µ–¥–µ–ª—è –Ω–∞—á–∞—Ç–∞</b><div id="v_week" class="muted">‚Äî</div></div>
        </div>
        <div>
          <b>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ —Å–µ—Å—Å–∏–∏</b>
          <div id="v_comment" class="muted" style="white-space:pre-wrap">‚Äî</div>
        </div>
        <div>
          <b>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –î–ë–¢</b>
          <div id="v_dbt" style="background:#fff;border:1px solid var(--line);border-radius:12px;padding:12px"></div>
        </div>
        <div>
          <b>–í—Å–µ –¥–∞–Ω–Ω—ã–µ</b>
          <pre id="v_json">{}</pre>
        </div>
      </div>
    </div>
  </div>

  <!-- Supabase –∫–ª–∏–µ–Ω—Ç -->
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js@2';

    // –ª—ë–≥–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è
    const sak=document.getElementById('sak'), W=innerWidth, N=12;
    for(let i=0;i<N;i++){
      const s=document.createElement('div'); s.className='lite'; s.textContent='üå∏';
      s.style.left=(Math.random()*W)+'px'; s.style.animationDuration=(12+Math.random()*12)+'s';
      s.style.animationDelay=(Math.random()*6)+'s'; sak.appendChild(s);
    }

    const SUPA_URL = 'https://jefcwyyxvoihtykizqem.supabase.co';
    const SUPA_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplZmN3eXl4dm9paHR5a2l6cWVtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTk1Mzg0MTksImV4cCI6MjA3NTExNDQxOX0.pw2F9cpmeYBrTdW67_Xcpg4AhVKX2b0osGdngzLBBGI';
    const supabase = createClient(SUPA_URL, SUPA_KEY);

    const $ = s=>document.querySelector(s);
    const st=$('#status'), main=$('#main');

    const params = new URLSearchParams(location.search);
    const id = params.get('id');

    if(!id){ st.textContent='–ù–µ –ø–µ—Ä–µ–¥–∞–Ω –ø–∞—Ä–∞–º–µ—Ç—Ä id'; }
    else{
      try{
        const { data, error } = await supabase
          .from('diaries')
          .select('data')
          .eq('id', id)
          .single();

        if(error || !data){ st.textContent='–ó–∞–ø–∏—Å—å –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ üò¢'; console.error(error); }
        else{
          st.style.display='none'; main.style.display='grid';
          const d = data.data || {};
          $('#v_name').textContent = d.name || '‚Äî';
          $('#v_date').textContent = d.date || '‚Äî';
          $('#v_week').textContent = d.week_start || '‚Äî';
          $('#v_comment').textContent = d.session_comment || '‚Äî';
          $('#v_dbt').innerHTML = (d.dbt_hw_html || '').trim() || '<span class="muted">–Ω–µ—Ç</span>';
          $('#v_json').textContent = JSON.stringify(d, null, 2);
        }
      }catch(e){
        console.error(e); st.textContent='–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏';
      }
    }
  </script>
</body>
</html>

