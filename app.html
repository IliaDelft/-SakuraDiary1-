<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
  <link rel="apple-touch-icon" href="favicon.svg">
  <meta name="theme-color" content="#ffeef6">
<meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–°–∞–∫—É—Ä–∞ ‚Äî –¥–Ω–µ–≤–Ω–∏–∫ –ö–ü–¢ üå∏</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;700;800&display=swap&subset=cyrillic-ext" rel="stylesheet">
  <style>
    .modal.hidden{display:none!important}

    :root{--bg:#fff8fb;--panel:#ffeef6;--panel-2:#ffe4f0;--ink:#2b2b2b;--muted:#6c6c6c;--brand:#e9a4c4;--brand-2:#d883ab;--line:#f5cfe0;--focus:#c96ea1}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:15px/1.5 'Manrope', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial}
    .wrap{max-width:1220px;margin:22px auto;padding:0 14px;position:relative}
    .app-title{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap}
    h1{margin:0;font-size:clamp(20px,3vw,30px);font-weight:800;letter-spacing:.2px}
    .tagline{color:var(--muted);font-size:13px}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:14px;padding:14px;box-shadow:0 6px 18px rgba(201,110,161,.06)}
    .toolbar{display:flex;flex-wrap:wrap;gap:8px;align-items:center}
    button,.btn{appearance:none;border:1px solid var(--brand-2);color:#fff;background:linear-gradient(180deg,var(--brand),var(--brand-2));padding:9px 12px;border-radius:11px;cursor:pointer;font-weight:800}
    .ghost{background:transparent;color:var(--brand-2);border-color:var(--brand-2)}
    .tabs{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}
    .tab-btn{background:var(--panel-2);color:var(--ink);border:1px solid var(--line)}
    .tab-btn.active{background:#fff;border-color:var(--brand-2);box-shadow:0 0 0 3px #f7d2e6}
    .tab{display:none;margin-top:12px} .tab.active{display:block}
    table{width:100%;border-collapse:collapse;table-layout:fixed} .table-wrap{overflow:auto}
    th,td{border:1px solid var(--line);padding:6px;vertical-align:top} th{background:var(--panel-2);font-weight:700}
    thead th{position:sticky;top:0;z-index:1;white-space:normal;line-height:1.2}
    .subhead{font-size:11px;color:var(--muted)} .small{font-size:12px} .center{text-align:center}
    input[type=number],input[type=text],select,textarea{width:100%;padding:8px 10px;border-radius:10px;border:1px solid var(--line);background:#fff;font-family:inherit}
    input:focus,select:focus,textarea:focus{outline:2px solid var(--focus);outline-offset:1px}
    textarea{min-height:90px}
    .note{background:#fff;border:1px dashed var(--line);padding:10px;border-radius:12px}
    label.note{display:flex;align-items:center;gap:8px;min-width:0;line-height:1.2}
    input[type=date]{padding-right:36px}
    .split{display:grid;gap:14px;grid-template-columns:1.45fr .55fr}
    @media(max-width:980px){.split{grid-template-columns:1fr} thead th{position:static}}
    .week-note{font-size:14px;color:var(--muted)}
    .day-block{background:#fff;border:1px solid var(--line);border-radius:14px;padding:12px;margin-bottom:10px}
    .day-head{display:flex;align-items:center;gap:10px;font-weight:800;font-size:18px}
    .day-head .badge{border:1px solid var(--line);background:var(--panel-2);border-radius:8px;padding:2px 8px}
    .day-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:780px){.day-grid{grid-template-columns:1fr}}
    .rte{background:#fff;border:1px solid var(--line);border-radius:14px;min-height:280px;padding:14px;line-height:1.5}
    .rte:focus{outline:2px solid var(--focus)} .rte img{max-width:100%;height:auto;border-radius:10px;border:1px solid var(--line);display:block;margin:8px 0}
    .rte blockquote{border-left:3px solid var(--brand-2);margin:8px 0;padding:6px 10px;background:var(--panel)}
    .sakura-lite{position:fixed;inset:0;pointer-events:none;z-index:0}
    .lite-petal{position:absolute;font-size:18px;opacity:.35;animation: drift linear infinite}
    @keyframes drift{0%{transform: translateY(-10vh) translateX(0) rotate(0deg)}100%{transform: translateY(110vh) translateX(var(--dx,40px)) rotate(360deg); opacity: 0;}}
    @media print{ .sakura-lite{display:none} }
  </style>
</head>
<body>
  <div class="sakura-lite" id="sak"></div>
  <div class="wrap">
    <div class="app-title">
      <h1>üå∏ –°–∞–∫—É—Ä–∞ ‚Äî –¥–Ω–µ–≤–Ω–∏–∫ –ö–ü–¢</h1>
      <div class="toolbar">
        <button id="saveBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —á–µ—Ä–Ω–æ–≤–∏–∫</button>
        <button id="saveWeekBtn" class="ghost">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–µ–¥–µ–ª—é üå∏</button>
        <button id="weeksBtn" class="ghost">–ù–µ–¥–µ–ª–∏ ‚§µ</button>
        <button id="printBtn" class="ghost" onclick="window.print()">–ü–µ—á–∞—Ç—å</button>
        <button id="shareBtn" class="ghost" onclick="window.__share && window.__share()">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π</button>
        <input id="shareOut" readonly style="max-width:420px;width:100%;border:1px dashed var(--line);padding:8px;border-radius:10px;background:#fff" placeholder="—Å—Å—ã–ª–∫–∞ –ø–æ—è–≤–∏—Ç—Å—è —Ç—É—Ç" />
        <button id="resetBtn" class="ghost" title="–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—ë">–û—á–∏—Å—Ç–∏—Ç—å</button>
      </div>
    </div>

    <p class="tagline">–õ–æ–∫–∞–ª—å–Ω–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ + –ø—É–±–ª–∏–∫–∞—Ü–∏—è –ø–æ —Å—Å—ã–ª–∫–µ. –®—Ä–∏—Ñ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω ‚Äî ü§ç Manrope (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞).</p>

    <div class="tabs">
      <button class="tab-btn active" data-tab="t1">üìí –î–Ω–µ–≤–Ω–∏–∫–æ–≤–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞</button>
      <button class="tab-btn" data-tab="t2">üß† –°‚Äë–ú‚Äë–≠‚Äë–†</button>
      <button class="tab-btn" data-tab="t3">üóìÔ∏è –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω–æ–µ —Ä–µ–∑—é–º–µ</button>
      <button class="tab-btn" data-tab="t4">üìù –î–ó –î–ë–¢</button>
    </div>

    <!-- sections kept same as before (omitted here to focus on toolbar); content will be appended by JS -->
    <section id="t1" class="tab active"><div class="card grid"><div class="split"><div class="grid">
      <div class="grid" style="grid-template-columns:1fr 1fr 1fr; gap:10px">
        <label class="note">–ò–º—è: <input name="name" placeholder="–ò–º—è üëë"/></label>
        <label class="note">–î–∞—Ç–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è: <input name="date" type="date" /></label>
        <label class="note">–ù–µ–¥–µ–ª—è –Ω–∞—á–∞—Ç–∞: <input name="week_start" type="date" /></label>
      </div>
      <div class="note small"><b>–®–∫–∞–ª—ã:</b> –ø–æ–±—É–∂–¥–µ–Ω–∏—è 0‚Äì5 ¬∑ –Ω–∞–≤—ã–∫–∏ 0‚Äì7.</div>
      <div class="table-wrap"><table><thead><tr>
        <th rowspan="3" class="center">–î–µ–Ω—å</th>
        <th colspan="4" class="center">–°–∏–ª—å–Ω–æ–µ –ø–æ–±—É–∂–¥–µ–Ω–∏–µ üôè</th>
        <th colspan="3" class="center">–í—ã—Å—à–∏–π —Ä–µ–π—Ç–∏–Ω–≥ –∑–∞ –Ω–µ–¥–µ–ª—é üèÜ</th>
        <th rowspan="3" class="center">–ù–∞–≤—ã–∫–∏ 0‚Äì7</th>
      </tr><tr>
        <th class="center small">–∫ —Å—É–∏—Ü–∏–¥—É</th>
        <th class="center small">–∫ —Å–∞–º–æ–ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—é</th>
        <th class="center small">–∫ –ø—Ä–∏—ë–º—É –≤–µ—â–µ—Å—Ç–≤</th>
        <th class="center small">–∫ –∞–≥—Ä–µ—Å—Å–∏–∏</th>
        <th class="center small">–æ–ø—É—Å—Ç–æ—à—ë–Ω–Ω–æ—Å—Ç—å</th>
        <th class="center small">—Ñ–∏–∑. —É—Å—Ç–∞–ª–æ—Å—Ç—å</th>
        <th class="center small">—Ä–∞–¥–æ—Å—Ç—å</th>
      </tr><tr>
        <th class="center subhead">0‚Äì5</th><th class="center subhead">0‚Äì5</th><th class="center subhead">0‚Äì5</th>
        <th class="center subhead">0‚Äì5</th><th class="center subhead">0‚Äì5</th><th class="center subhead">0‚Äì5</th><th class="center subhead">0‚Äì5</th>
      </tr></thead><tbody id="rows-week"></tbody></table></div>
      <div class="grid" style="grid-template-columns:1fr 1fr; gap:12px">
        <div><h3>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –≤ –ø—Ä–∏—ë–º–µ –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤</h3><textarea name="med_changes" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: ‚Ä¶"></textarea></div>
        <div><h3>–î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã</h3><textarea name="hw_results" placeholder="–ß—Ç–æ –ø—Ä–æ–±–æ–≤–∞–ª, —á—Ç–æ –ø–æ–ª—É—á–∏–ª–æ—Å—å / –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å"></textarea></div>
      </div>
    </div>
    <aside class="grid">
      <div class="card" style="background:#fff"><h3>‚≠ê –õ–µ–≥–µ–Ω–¥–∞ –Ω–∞–≤—ã–∫–æ–≤</h3>
        <div class="small"><div>0 ‚Äî –Ω–µ –¥—É–º–∞–ª, –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª</div><div>1 ‚Äî –¥—É–º–∞–ª, –Ω–µ –ø—Ä–∏–º–µ–Ω—è–ª</div><div>2 ‚Äî —Ö–æ—Ç–µ–ª –ø—Ä–∏–º–µ–Ω–∏—Ç—å</div><div>3 ‚Äî –ø—ã—Ç–∞–ª—Å—è, –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å</div><div>4 ‚Äî –ø—Ä–∏–º–µ–Ω–∏–ª, –Ω–µ –ø–æ–º–æ–≥–ª–æ</div><div>5 ‚Äî –ø—Ä–∏–º–µ–Ω–∏–ª, –ø–æ–º–æ–≥–ª–æ</div><div>6 ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–ª, –Ω–µ –ø–æ–º–æ–≥–ª–æ</div><div>7 ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–º–µ–Ω–∏–ª, –ø–æ–º–æ–≥–ª–æ</div></div>
      </div>
      <div class="card" style="background:#fff"><h3>üå∏ –¢–∞–±–ª–∏—Ü–∞ –ø–æ–±—É–∂–¥–µ–Ω–∏–π</h3>
        <table><thead><tr><th>–ü–æ–±—É–∂–¥–µ–Ω–∏–µ</th><th style="width:160px">–ò–Ω—Ç–µ–Ω—Å. (0‚Äì5)</th></tr></thead>
        <tbody><tr><td>–ë—Ä–æ—Å–∏—Ç—å —Ç–µ—Ä–∞–ø–∏—é</td><td><input type="number" min="0" max="5" name="urge_quit"/></td></tr>
        <tr><td>–ü—Ä–∏–Ω—è—Ç—å –≤–µ—â–µ—Å—Ç–≤–∞</td><td><input type="number" min="0" max="5" name="urge_substance"/></td></tr>
        <tr><td>–£–±–∏—Ç—å —Å–µ–±—è</td><td><input type="number" min="0" max="5" name="urge_suicide"/></td></tr></tbody></table>
      </div>
      <div class="card" style="background:#fff"><h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –ø—Ä–æ—à–µ–¥—à–µ–π —Å–µ—Å—Å–∏–∏</h3><textarea name="session_comment" placeholder="–ó–∞–º–µ—Ç–∫–∏ –∏ –ø–ª–∞–Ω—ã"></textarea></div>
    </aside></div></div></section>

    <section id="t4" class="tab"><div class="card"><h3 style="margin-top:0">üìù –î–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ –î–ë–¢</h3><p class="small">–ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–ª—è—Ç—å —Ç–µ–∫—Å—Ç –∏ –∫–∞—Ä—Ç–∏–Ω–∫–∏.</p><div id="dbtEditor" class="rte" contenteditable="true"></div></div></section>

    <section id="t2" class="tab"><div class="card"><div class="grid" style="grid-template-columns:1fr; gap:12px"><div class="note">7 —ç–ø–∏–∑–æ–¥–æ–≤ –∑–∞ –Ω–µ–¥–µ–ª—é‚Ä¶</div><table><thead><tr><th style="width:6%">#</th><th>–° ‚Äî –°–∏—Ç—É–∞—Ü–∏—è</th><th>–ú ‚Äî –ú—ã—Å–ª—å</th><th>–≠ ‚Äî –≠–º–æ—Ü–∏–∏</th><th style="width:22%">–† ‚Äî –¢–µ–ª–æ</th><th style="width:22%">–† ‚Äî –ü–æ–≤–µ–¥–µ–Ω–∏–µ</th></tr></thead><tbody id="smer-rows"></tbody></table></div></div></section>

    <section id="t3" class="tab"><div class="card"><p class="week-note">–ö–æ—Ä–æ—Ç–∫–∏–µ –∑–∞–º–µ—Ç–∫–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –¥–Ω—é‚Ä¶</p>
      <div class="day-block"><div class="day-head">üìÖ <span class="badge">1</span> –ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</div><div class="day-grid">
      <label class="note">–≠–º–æ—Ü–∏–∏ (0‚Äì100): <input type="number" min="0" max="100" name="sum_mon_emotion_score"/></label>
      <label class="note">–≠–º–æ—Ü–∏–∏ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ: <input type="text" name="sum_mon_emotion_text"/></label>
      <label class="note">–°–∏—Ç—É–∞—Ü–∏—è: <input type="text" name="sum_mon_situation"/></label>
      <label class="note">–ù–∞–≤—ã–∫–∏: <input type="text" name="sum_mon_skills"/></label></div></div>
      <div class="day-block"><div class="day-head">üìÖ <span class="badge">2</span> –í—Ç–æ—Ä–Ω–∏–∫</div><div class="day-grid">
      <label class="note">–≠–º–æ—Ü–∏–∏ (0‚Äì100): <input type="number" min="0" max="100" name="sum_tue_emotion_score"/></label>
      <label class="note">–≠–º–æ—Ü–∏–∏ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ: <input type="text" name="sum_tue_emotion_text"/></label>
      <label class="note">–°–∏—Ç—É–∞—Ü–∏—è: <input type="text" name="sum_tue_situation"/></label>
      <label class="note">–ù–∞–≤—ã–∫–∏: <input type="text" name="sum_tue_skills"/></label></div></div>
      <div class="day-block"><div class="day-head">üìÖ <span class="badge">3</span> –°—Ä–µ–¥–∞</div><div class="day-grid">
      <label class="note">–≠–º–æ—Ü–∏–∏ (0‚Äì100): <input type="number" min="0" max="100" name="sum_wed_emotion_score"/></label>
      <label class="note">–≠–º–æ—Ü–∏–∏ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ: <input type="text" name="sum_wed_emotion_text"/></label>
      <label class="note">–°–∏—Ç—É–∞—Ü–∏—è: <input type="text" name="sum_wed_situation"/></label>
      <label class="note">–ù–∞–≤—ã–∫–∏: <input type="text" name="sum_wed_skills"/></label></div></div>
      <div class="day-block"><div class="day-head">üìÖ <span class="badge">4</span> –ß–µ—Ç–≤–µ—Ä–≥</div><div class="day-grid">
      <label class="note">–≠–º–æ—Ü–∏–∏ (0‚Äì100): <input type="number" min="0" max="100" name="sum_thu_emotion_score"/></label>
      <label class="note">–≠–º–æ—Ü–∏–∏ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ: <input type="text" name="sum_thu_emotion_text"/></label>
      <label class="note">–°–∏—Ç—É–∞—Ü–∏—è: <input type="text" name="sum_thu_situation"/></label>
      <label class="note">–ù–∞–≤—ã–∫–∏: <input type="text" name="sum_thu_skills"/></label></div></div>
      <div class="day-block"><div class="day-head">üìÖ <span class="badge">5</span> –ü—è—Ç–Ω–∏—Ü–∞</div><div class="day-grid">
      <label class="note">–≠–º–æ—Ü–∏–∏ (0‚Äì100): <input type="number" min="0" max="100" name="sum_fri_emotion_score"/></label>
      <label class="note">–≠–º–æ—Ü–∏–∏ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ: <input type="text" name="sum_fri_emotion_text"/></label>
      <label class="note">–°–∏—Ç—É–∞—Ü–∏—è: <input type="text" name="sum_fri_situation"/></label>
      <label class="note">–ù–∞–≤—ã–∫–∏: <input type="text" name="sum_fri_skills"/></label></div></div>
      <div class="day-block"><div class="day-head">üìÖ <span class="badge">6</span> –°—É–±–±–æ—Ç–∞</div><div class="day-grid">
      <label class="note">–≠–º–æ—Ü–∏–∏ (0‚Äì100): <input type="number" min="0" max="100" name="sum_sat_emotion_score"/></label>
      <label class="note">–≠–º–æ—Ü–∏–∏ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ: <input type="text" name="sum_sat_emotion_text"/></label>
      <label class="note">–°–∏—Ç—É–∞—Ü–∏—è: <input type="text" name="sum_sat_situation"/></label>
      <label class="note">–ù–∞–≤—ã–∫–∏: <input type="text" name="sum_sat_skills"/></label></div></div>
      <div class="day-block"><div class="day-head">üìÖ <span class="badge">7</span> –í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ</div><div class="day-grid">
      <label class="note">–≠–º–æ—Ü–∏–∏ (0‚Äì100): <input type="number" min="0" max="100" name="sum_sun_emotion_score"/></label>
      <label class="note">–≠–º–æ—Ü–∏–∏ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ: <input type="text" name="sum_sun_emotion_text"/></label>
      <label class="note">–°–∏—Ç—É–∞—Ü–∏—è: <input type="text" name="sum_sun_situation"/></label>
      <label class="note">–ù–∞–≤—ã–∫–∏: <input type="text" name="sum_sun_skills"/></label></div></div>
    </div></section>

    <p class="small muted" style="margin-top:12px">–°–¥–µ–ª–∞–Ω–æ —Å –∑–∞–±–æ—Ç–æ–π üå∏. –ú–æ–∂–Ω–æ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å—Å—ã–ª–∫–æ–π –∏–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ.</p>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const $=(s,r=document)=>r.querySelector(s); const $$=(s,r=document)=>Array.from(r.querySelectorAll(s));
      const DAYS=["–ü–Ω.","–í—Ç.","–°—Ä.","–ß—Ç.","–ü—Ç.","–°–±.","–í—Å–∫."];
      const STORAGE_KEY='sakura_clean_draft_v2';
      const STORE_PREFIX='sakura_clean_week_';
      const STORE_INDEX='sakura_clean_weeks_index_v1';
      const DBT_KEY='dbt_hw_html';

      // Sakura drizzle
      const sak=document.getElementById('sak'); const W=window.innerWidth;
      for(let i=0;i<12;i++){ const p=document.createElement('div'); p.className='lite-petal'; p.textContent='üå∏'; p.style.left=Math.random()*W+'px'; p.style.animationDuration=(12+Math.random()*10)+'s'; p.style.animationDelay=(Math.random()*6)+'s'; p.style.setProperty('--dx',(Math.random()*80-40)+'px'); sak.appendChild(p); }

      // Build weekly table
      const tbody=document.getElementById('rows-week');
      const num=(n,min,max)=>`<input type="number" name="${n}" min="${min}" max="${max}">`;
      DAYS.forEach((d,i)=>{const tr=document.createElement('tr');tr.innerHTML=`
        <th class="center">${d}</th>
        <td>${num(`urge_suicide_${i}`,0,5)}</td>
        <td>${num(`urge_selfharm_${i}`,0,5)}</td>
        <td>${num(`urge_substances_${i}`,0,5)}</td>
        <td>${num(`urge_aggr_${i}`,0,5)}</td>
        <td>${num(`emptiness_${i}`,0,5)}</td>
        <td>${num(`fatigue_${i}`,0,5)}</td>
        <td>${num(`joy_${i}`,0,5)}</td>
        <td>${num(`skills_${i}`,0,7)}</td>`; tbody.appendChild(tr); });

      // S-M-E-R rows
      const smer=document.getElementById('smer-rows');
      for(let i=1;i<=7;i++){const tr=document.createElement('tr');tr.innerHTML=`
        <th class="center">${i}</th>
        <td><textarea name="s_${i}"></textarea></td>
        <td><textarea name="m_${i}"></textarea></td>
        <td><textarea name="e_${i}"></textarea></td>
        <td><textarea name="r_body_${i}"></textarea></td>
        <td><textarea name="r_beh_${i}"></textarea></td>`; smer.appendChild(tr);}  

      // Save / Load local
      const getAll=()=>{const d={}; $$('input,select,textarea').forEach(el=>d[el.name]=el.type==='checkbox'?el.checked:el.value); d[DBT_KEY]=$("#dbtEditor")?$("#dbtEditor").innerHTML:''; return d;}
      const setAll=(d)=>{if(!d) return; $$('input,select,textarea').forEach(el=>{if(Object.prototype.hasOwnProperty.call(d, el.name)) el.value=d[el.name];}); if($("#dbtEditor") && d[DBT_KEY]!==undefined) $("#dbtEditor").innerHTML=d[DBT_KEY];}
      const saveLocal=()=>localStorage.setItem(STORAGE_KEY, JSON.stringify(getAll()));
      const loadLocal=()=>setAll(JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}'));
      document.addEventListener('input', saveLocal);
      $('#saveBtn').addEventListener('click', ()=>{ saveLocal(); alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –ª–æ–∫–∞–ª—å–Ω–æ üå∏'); });
      $('#resetBtn').addEventListener('click', ()=>{ if(confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å–µ –ø–æ–ª—è?')){ localStorage.removeItem(STORAGE_KEY); location.reload(); }});

      // Tabs
      $$('.tab-btn').forEach(btn=> btn.addEventListener('click', ()=>{ $$('.tab-btn').forEach(b=>b.classList.remove('active')); btn.classList.add('active'); $$('.tab').forEach(t=>t.classList.remove('active')); document.getElementById(btn.dataset.tab).classList.add('active'); }));

      // Weeks modal (local)
      const idxRead=()=>{ try{return JSON.parse(localStorage.getItem(STORE_INDEX)||'[]');}catch{return []} };
      const idxWrite=(v)=> localStorage.setItem(STORE_INDEX, JSON.stringify(v));
      const weekId=()=> document.querySelector('input[name="week_start"]').value || new Date().toISOString().slice(0,10);
      const weekTitle=()=>{ const n=document.querySelector('input[name="name"]').value||'–ë–µ–∑ –∏–º–µ–Ω–∏'; const ws=document.querySelector('input[name="week_start"]').value||'‚Äî'; return `${ws} ‚Äî ${n}`; };
      function saveWeek(){ const id=weekId(); const data=getAll(); const when=new Date().toISOString(); const title=weekTitle(); localStorage.setItem(STORE_PREFIX+id, JSON.stringify({id,title,when,data})); const idx=idxRead(); const ex=idx.find(x=>x.id===id); if(ex){ex.title=title;ex.when=when;} else {idx.unshift({id,title,when});} idxWrite(idx); alert('–ù–µ–¥–µ–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ üå∏'); }
      $('#saveWeekBtn').addEventListener('click', saveWeek);

      const modal=document.createElement('div'); modal.innerHTML=`<div id="weeksModal" class="modal hidden" aria-hidden="true" style="position:fixed;inset:0;z-index:50"><div class="modal__backdrop" style="position:absolute;inset:0;background:rgba(0,0,0,.25)"></div><div class="modal__content card" role="dialog" aria-modal="true" style="position:relative;max-width:720px;margin:10vh auto;background:var(--panel)"><h3 style="margin-top:0">–°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –Ω–µ–¥–µ–ª–∏</h3><div class="small" id="weeksEmpty" style="display:none">–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –Ω–µ–¥–µ–ª—å</div><select id="weeksSelect" size="8" style="width:100%; margin:8px 0"></select><div style="display:flex; gap:8px; justify-content:flex-end"><button id="openWeekBtn">–û—Ç–∫—Ä—ã—Ç—å</button><button id="deleteWeekBtn" class="ghost">–£–¥–∞–ª–∏—Ç—å</button><button id="closeWeeksBtn" class="ghost">–ó–∞–∫—Ä—ã—Ç—å</button></div></div></div>`;
      document.body.appendChild(modal);
      const sel=modal.querySelector('#weeksSelect'); const empty=modal.querySelector('#weeksEmpty');
      function openWeeks(){ sel.innerHTML=''; const idx=idxRead(); empty.style.display=idx.length?'none':'block'; idx.forEach(w=>{ const opt=document.createElement('option'); opt.value=w.id; opt.textContent=`${w.id} ‚Äî ${w.title}`; sel.appendChild(opt); }); modal.firstChild.classList.remove('hidden'); modal.firstChild.setAttribute('aria-hidden','false'); }
      function closeWeeks(){ modal.firstChild.classList.add('hidden'); modal.firstChild.setAttribute('aria-hidden','true'); }
      $('#weeksBtn').addEventListener('click', openWeeks);
      modal.querySelector('#closeWeeksBtn').addEventListener('click', closeWeeks);
      modal.querySelector('.modal__backdrop').addEventListener('click', closeWeeks);
      modal.querySelector('#openWeekBtn').addEventListener('click', ()=>{ const id=sel.value; if(!id) return; const raw=localStorage.getItem(STORE_PREFIX+id); if(!raw) return; try{ const {data}=JSON.parse(raw); setAll(data); saveLocal(); closeWeeks(); }catch{ alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∑–∞–ø–∏—Å–∏'); } });
      modal.querySelector('#deleteWeekBtn').addEventListener('click', ()=>{ const id=sel.value; if(!id) return; if(!confirm('–£–¥–∞–ª–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –Ω–µ–¥–µ–ª—é?')) return; localStorage.removeItem(STORE_PREFIX+id); const idx=idxRead().filter(w=>w.id!==id); idxWrite(idx); openWeeks(); });

      // Share-by-link (serverless, no auth)
      document.getElementById('shareBtn').addEventListener('click', async ()=>{
        const payload = getAll();
        const packed = LZString.compressToEncodedURIComponent(JSON.stringify(payload));
        const link = `${location.origin}${location.pathname}#s=` + packed;
        document.getElementById('shareOut').value = link;
        try { await navigator.clipboard.writeText(link); alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ üå∏'); } catch {}
      });

      // –∞–≤—Ç–æ-–∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑ URL-—Ö–µ—à–∞
      const hash = location.hash || '';
      if (hash.startsWith('#s=')) {
        try {
          const raw = LZString.decompressFromEncodedURIComponent(hash.slice(3));
          const obj = JSON.parse(raw);
          setAll(obj);
          saveLocal();
          history.replaceState({}, '', location.pathname);
        } catch (e) { console.error('share-decode-fail', e); }
      }

      loadLocal();
    });
  </script>

<script>
/*! LZString v1.4.4 (tiny build: compressToEncodedURIComponent/decompressFromEncodedURIComponent) */
var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",e={},t={},i={compressToEncodedURIComponent:function(o){return null==o?"":i._compress(o,6,function(o){return n.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e))})},_compress:function(o,n,e){if(null==o)return"";var t,i,c,s={},p={},u="",a="",l="",f=2,h=3,d=2,m=[],v=0,g=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=h++,p[u]=!0),a=l+u,Object.prototype.hasOwnProperty.call(s,a))l=a;else{if(Object.prototype.hasOwnProperty.call(p,l)){if(l.charCodeAt(0)<256){for(t=0;t<d;t++)v<<=1,g==n-1?(g=0,m.push(e(v)),v=0):g++;for(c=l.charCodeAt(0),t=0;t<8;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}else{for(c=1,t=0;t<d;t++)v=v<<1|c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c=0;for(c=l.charCodeAt(0),t=0;t<16;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete p[l]}else for(c=s[l],t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;f--,0==f&&(f=Math.pow(2,d),d++),s[a]=h++,l=String(u)}if(""!==l){if(Object.prototype.hasOwnProperty.call(p,l)){if(l.charCodeAt(0)<256){for(t=0;t<d;t++)v<<=1,g==n-1?(g=0,m.push(e(v)),v=0):g++;for(c=l.charCodeAt(0),t=0;t<8;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}else{for(c=1,t=0;t<d;t++)v=v<<1|c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c=0;for(c=l.charCodeAt(0),t=0;t<16;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete p[l]}else for(c=s[l],t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;f--,0==f&&(f=Math.pow(2,d),d++)}for(c=2,t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;for(;;){if(v<<=1,g==n-1){m.push(e(v));break}g++}return m.join("")},_decompress:function(o,n,e){var t,i,c,s,p,u,a,l,f=[],h=4,d=4,m=3,v="",g=[],w={val:e(0),position:n,index:1};for(i=0;i<3;i+=1)f[i]=i;for(a=0,u=Math.pow(2,2),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;switch(t=a){case 0:for(a=0,u=Math.pow(2,8),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;c=r(a);break;case 1:for(a=0,u=Math.pow(2,16),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;c=r(a);break;case 2:return""}for(f[3]=c,s=c,g.push(c);;){if(w.index>o)return"";for(a=0,u=Math.pow(2,m),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;switch(c=a){case 0:for(a=0,u=Math.pow(2,8),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;f[d++]=r(a),c=d-1,m--;break;case 1:for(a=0,u=Math.pow(2,16),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;f[d++]=r(a),c=d-1,m--;break;case 2:return g.join("")}if(0==d&&(d=Math.pow(2,m),m++),f[c])v=f[c];else{if(c!==d)return null;v=s+s.charAt(0)}g.push(v),f[d++]=s+v.charAt(0),s=v,0==--h&&(h=Math.pow(2,m),m++)}}
}();
</script>


<!-- safe addon -->
<script>
// Guard: if previous script crashed, this one still runs
(function(){
  // Minimal LZString (encoded URI variant only)
  if (typeof LZString === 'undefined') {
    var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",e={},t={},i={compressToEncodedURIComponent:function(o){return null==o?"":i._compress(o,6,function(o){return n.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e))})},_compress:function(o,n,e){if(null==o)return"";var t,i,c,s={},p={},u="",a="",l="",f=2,h=3,d=2,m=[],v=0,g=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=h++,p[u]=!0),a=l+u,Object.prototype.hasOwnProperty.call(s,a))l=a;else{if(Object.prototype.hasOwnProperty.call(p,l)){if(l.charCodeAt(0)<256){for(t=0;t<d;t++)v<<=1,g==n-1?(g=0,m.push(e(v)),v=0):g++;for(c=l.charCodeAt(0),t=0;t<8;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}else{for(c=1,t=0;t<d;t++)v=v<<1|c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c=0;for(c=l.charCodeAt(0),t=0;t<16;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete p[l]}else for(c=s[l],t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;f--,0==f&&(f=Math.pow(2,d),d++),s[a]=h++,l=String(u)}if(""!==l){if(Object.prototype.hasOwnProperty.call(p,l)){if(l.charCodeAt(0)<256){for(t=0;t<d;t++)v<<=1,g==n-1?(g=0,m.push(e(v)),v=0):g++;for(c=l.charCodeAt(0),t=0;t<8;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}else{for(c=1,t=0;t<d;t++)v=v<<1|c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c=0;for(c=l.charCodeAt(0),t=0;t<16;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete p[l]}else for(c=s[l],t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;f--,0==f&&(f=Math.pow(2,d),d++)}for(c=2,t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;for(;;){if(v<<=1,g==n-1){m.push(e(v));break}g++}return m.join("")},_decompress:function(o,n,e){var t,i,c,s,p,u,a,l,f=[],h=4,d=4,m=3,v="",g=[],w={val:e(0),position=n,index:1};for(i=0;i<3;i+=1)f[i]=i;for(a=0,u=Math.pow(2,2),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;switch(t=a){case 0:for(a=0,u=Math.pow(2,8),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;c=String.fromCharCode(a);break;case 1:for(a=0,u=Math.pow(2,16),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;c=String.fromCharCode(a);break;case 2:return""}for(f[3]=c,s=c,g.push(c);;){if(w.index>o)return"";for(a=0,u=Math.pow(2,m),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;switch(c=a){case 0:for(a=0,u=Math.pow(2,8),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;f[d++]=String.fromCharCode(a),c=d-1,m--;break;case 1:for(a=0,u=Math.pow(2,16),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;f[d++]=String.fromCharCode(a),c=d-1,m--;break;case 2:return g.join("")}if(0==d&&(d=Math.pow(2,m),m++),f[c])v=f[c];else{if(c!==d)return null;v=s+s.charAt(0)}g.push(v),f[d++]=s+v.charAt(0),s=v,0==--h&&(h=Math.pow(2,m),m++)}}
  }();
  }

  function $$(sel, root){ return Array.from((root||document).querySelectorAll(sel)); }
  function $(sel, root){ return (root||document).querySelector(sel); }

  document.addEventListener('DOMContentLoaded', function(){
    // PRINT
    var printBtn = document.getElementById('printBtn');
    if (printBtn) printBtn.addEventListener('click', function(){ window.print(); });

    // SHARE (hash-based)
    var shareBtn = document.getElementById('shareBtn');
    if (shareBtn) shareBtn.addEventListener('click', async function(){
      try{
        // Collect values
        var data = {}; $$('input,select,textarea').forEach(function(el){
          data[el.name] = (el.type==='checkbox') ? el.checked : el.value;
        });
        var ed = document.getElementById('dbtEditor'); if (ed) data['dbt_hw_html'] = ed.innerHTML || '';
        var packed = LZString.compressToEncodedURIComponent(JSON.stringify(data));
        var link = (location.origin + location.pathname + '#s=' + packed);
        var out = document.getElementById('shareOut'); if (out) out.value = link;
        try { await navigator.clipboard.writeText(link); alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ üå∏'); } catch(e) {}
      }catch(e){ console.error('share-failed', e); alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É'); }
    });

    // Decode on open
    if (location.hash && location.hash.indexOf('#s=')===0) {
      try{
        var raw = LZString.decompressFromEncodedURIComponent(location.hash.slice(3)) || '{}';
        var obj = JSON.parse(raw);
        $$('input,select,textarea').forEach(function(el){
          if (obj.hasOwnProperty(el.name)) el.value = obj[el.name];
        });
        var ed = document.getElementById('dbtEditor'); if (ed && obj['dbt_hw_html']!==undefined) ed.innerHTML = obj['dbt_hw_html'];
        history.replaceState({}, '', location.pathname);
      }catch(e){ console.warn('decode-hash-failed', e); }
    }

    // Ensure modal hide class works
    var style = document.createElement('style');
    style.textContent = '.modal.hidden{display:none!important}';
    document.head.appendChild(style);
  });
})();
</script>


<script>
// ultimate fallback to ensure SHARE works
(function(){
  function collectData(){
    var d={};
    document.querySelectorAll('input,select,textarea').forEach(function(el){
      if(!el.name) return;
      d[el.name] = (el.type==='checkbox') ? !!el.checked : (el.value||"");
    });
    var ed=document.getElementById('dbtEditor');
    if(ed) d['dbt_hw_html']=ed.innerHTML||'';
    return d;
  }
  // tiny LZString if missing
  if (typeof LZString==='undefined') {
    var LZString=function(){function o(o,r){if(!t[o]){t[o]={};for(var n=0;n<o.length;n++)t[o][o.charAt(n)]=n}return t[o][r]}var r=String.fromCharCode,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",e={},t={},i={compressToEncodedURIComponent:function(o){return null==o?"":i._compress(o,6,function(o){return n.charAt(o)})},decompressFromEncodedURIComponent:function(r){return null==r?"":""==r?null:i._decompress(r.length,32,function(e){return o(n,r.charAt(e))})},_compress:function(o,n,e){if(null==o)return"";var t,i,c,s={},p={},u="",a="",l="",f=2,h=3,d=2,m=[],v=0,g=0;for(i=0;i<o.length;i+=1)if(u=o.charAt(i),Object.prototype.hasOwnProperty.call(s,u)||(s[u]=h++,p[u]=!0),a=l+u,Object.prototype.hasOwnProperty.call(s,a))l=a;else{if(Object.prototype.hasOwnProperty.call(p,l)){if(l.charCodeAt(0)<256){for(t=0;t<d;t++)v<<=1,g==n-1?(g=0,m.push(e(v)),v=0):g++;for(c=l.charCodeAt(0),t=0;t<8;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}else{for(c=1,t=0;t<d;t++)v=v<<1|c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c=0;for(c=l.charCodeAt(0),t=0;t<16;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete p[l]}else for(c=s[l],t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;f--,0==f&&(f=Math.pow(2,d),d++),s[a]=h++,l=String(u)}if(""!==l){if(Object.prototype.hasOwnProperty.call(p,l)){if(l.charCodeAt(0)<256){for(t=0;t<d;t++)v<<=1,g==n-1?(g=0,m.push(e(v)),v=0):g++;for(c=l.charCodeAt(0),t=0;t<8;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}else{for(c=1,t=0;t<d;t++)v=v<<1|c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c=0;for(c=l.charCodeAt(0),t=0;t<16;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1}f--,0==f&&(f=Math.pow(2,d),d++),delete p[l]}else for(c=s[l],t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;f--,0==f&&(f=Math.pow(2,d),d++)}for(c=2,t=0;t<d;t++)v=v<<1|1&c,g==n-1?(g=0,m.push(e(v)),v=0):g++,c>>=1;for(;;){if(v<<=1,g==n-1){m.push(e(v));break}g++}return m.join("")},_decompress:function(o,n,e){var t,i,c,s,p,u,a,l,f=[],h=4,d=4,m=3,v="",g=[],w={val:e(0),position=n,index:1};for(i=0;i<3;i+=1)f[i]=i;for(a=0,u=Math.pow(2,2),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;switch(t=a){case 0:for(a=0,u=Math.pow(2,8),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;c=String.fromCharCode(a);break;case 1:for(a=0,u=Math.pow(2,16),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;c=String.fromCharCode(a);break;case 2:return""}for(f[3]=c,s=c,g.push(c);;){if(w.index>o)return"";for(a=0,u=Math.pow(2,m),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;switch(c=a){case 0:for(a=0,u=Math.pow(2,8),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;f[d++]=String.fromCharCode(a),c=d-1,m--;break;case 1:for(a=0,u=Math.pow(2,16),l=1;l!=u;)p=w.val&w.position,w.position>>=1,0==w.position&&(w.position=n,w.val=e(w.index++)),a|=(p>0?1:0)*l,l<<=1;f[d++]=String.fromCharCode(a),c=d-1,m--;break;case 2:return g.join("")}if(0==d&&(d=Math.pow(2,m),m++),f[c])v=f[c];else{if(c!==d)return null;v=s+s.charAt(0)}g.push(v),f[d++]=s+v.charAt(0),s=v,0==--h&&(h=Math.pow(2,m),m++)}}
  }();
  }
  window.__share = async function(){
    try{
      var packed = LZString.compressToEncodedURIComponent(JSON.stringify(collectData()));
      var link = location.origin + location.pathname + '#s=' + packed;
      var out=document.getElementById('shareOut'); if(out) out.value=link;
      try{ await navigator.clipboard.writeText(link);}catch(e){}
      alert('–°—Å—ã–ª–∫–∞ –≥–æ—Ç–æ–≤–∞ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ üå∏');
    }catch(e){
      console.error(e); alert('–ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É');
    }
  };

  // decode on load if present
  if (location.hash && location.hash.indexOf('#s=')===0) {
    try{
      var raw=LZString.decompressFromEncodedURIComponent(location.hash.slice(3))||'{}';
      var obj=JSON.parse(raw);
      document.querySelectorAll('input,select,textarea').forEach(function(el){
        if(obj.hasOwnProperty(el.name)) el.value=obj[el.name];
      });
      var ed=document.getElementById('dbtEditor'); if(ed && obj['dbt_hw_html']!==undefined) ed.innerHTML=obj['dbt_hw_html'];
      history.replaceState({},'',location.pathname);
    }catch(e){ console.warn('decode fail', e); }
  }
})();
</script>

</body>
</html>
